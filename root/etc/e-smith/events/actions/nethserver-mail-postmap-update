#!/usr/bin/perl

#
# nethserver-mail-postmap-update
#
# Invoke postmap on every table declared on PostmapUpdateList prop.
#
# Copyright (C) 2012 Nethesis srl
#

use strict;
use esmith::ConfigDB;

my $event = shift;


my $configDb = esmith::ConfigDB->open_ro() || die('Could not open Config DB');

my @postmapList = split(',', $configDb->get_prop('mail', 'PostmapUpdateList'));

foreach my $db (@postmapList) {
    if( -r $db ) {
	system('/usr/sbin/postmap', $db);
    } else {
	warn "Postfix database table $db seems to be missing..\n";
    }
}
